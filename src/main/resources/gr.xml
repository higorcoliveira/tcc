<?xml version="1.0" encoding="UTF-8"?>
<queries>
	<sql>
		<discriminator>QUERY GESTAO RECURSOS COST CENTER</discriminator>
		<select>
			SELECT
			GCC.IDCOSTCENTER,GCC.NAME,
			CASE
			WHEN CC.ID IS NULL THEN 1 ELSE 0
			END AS "INSERT"
			FROM GR_COST_CENTER GCC
			LEFT OUTER JOIN
			$[GR_DATABASE].dbo.COSTCENTER CC ON GCC.IDCOSTCENTER = CC.ID
		</select>
	</sql>
	<sql>
		<discriminator>QUERY GESTAO RECURSOS EMPLOYEE INSERT</discriminator>
		<select>
			INSERT INTO $[GR_DATABASE].dbo.Employee (REGISTRY, NAME, EMAIL, PASSWORD, ACTIVE, CPF, CONTRACT, PHONE, IDCOSTCENTER, POSITION, LOGIN, CHANGEPASSWORD)
			SELECT GE.RE, GE.NAME, GE.EMAIL, GE.PASSWORD, GE.ACTIVE, GE.CPF, GE.CONTRACT, GE.PHONE_NUMBER, GE.COST_CENTER, GE.ROLE_GROUP, GE.RE, 0
			FROM GR_EMPLOYEE GE
			LEFT JOIN $[GR_DATABASE].dbo.Employee E ON GE.RE = E.registry
			WHERE E.ID IS NULL AND NOT EXISTS (SELECT ID FROM $[GR_DATABASE].dbo.employee WHERE CPF = GE.CPF)
		</select>
	</sql>
	<sql>
		<discriminator>QUERY GESTAO RECURSOS EMPLOYEE POOL INSERT</discriminator>
		<select>
			INSERT INTO $[GR_DATABASE].dbo.RoleEmployeePool (IDEMPLOYEE, IDPOOL, IDROLE)
			SELECT E.ID, $[ID_POOL], $[ID_ROLE]
			FROM GR_EMPLOYEE GE
			INNER JOIN $[GR_DATABASE].dbo.Employee E ON GE.RE = E.registry
			LEFT JOIN $[GR_DATABASE].dbo.RoleEmployeePool RE ON E.ID = RE.idEmployee
			WHERE RE.idEmployee IS NULL
		</select>
	</sql>
	<sql>
		<discriminator>QUERY GESTAO RECURSOS EMPLOYEE UPDATE</discriminator>
		<select>
			UPDATE $[GR_DATABASE].dbo.Employee
			SET REGISTRY = GE.RE, NAME = GE.NAME, EMAIL = GE.EMAIL, ACTIVE = GE.ACTIVE, CPF = GE.CPF, 
			CONTRACT = GE.CONTRACT, PHONE = GE.PHONE_NUMBER, IDCOSTCENTER = GE.COST_CENTER, POSITION = GE.ROLE_GROUP, LOGIN = GE.RE
			FROM $[GR_DATABASE].dbo.Employee E
			INNER JOIN (
				SELECT E.ID EMPLOYEE_ID, GE.RE, GE.NAME, GE.EMAIL, GE.PASSWORD, GE.ACTIVE, GE.CPF, GE.CONTRACT, GE.PHONE_NUMBER, GE.COST_CENTER, GE.ROLE_GROUP
				FROM GR_EMPLOYEE GE
				INNER JOIN $[GR_DATABASE].dbo.Employee E ON GE.RE = E.registry
				UNION
				SELECT E.ID EMPLOYEE_ID, GE.RE, GE.NAME, GE.EMAIL, GE.PASSWORD, GE.ACTIVE, GE.CPF, GE.CONTRACT, GE.PHONE_NUMBER, GE.COST_CENTER, GE.ROLE_GROUP
				FROM GR_EMPLOYEE GE
				INNER JOIN $[GR_DATABASE].dbo.Employee E ON GE.CPF = E.cpf
			) AS GE ON GE.EMPLOYEE_ID = E.ID
		</select>
	</sql>
</queries>